## M3 – Scheduler & Processing Engine

What to Build:

- Create /api/scheduler/tick endpoint that:
  - Finds due reminders (next_attempt_at <= now, status in [SCHEDULED, RETRYING, ESCALATED])
  - Atomically updates them to CALLING status (prevent race conditions)
  - Initiates Twilio calls with webhook URLs for voice/gather/status callbacks
  - Creates call_log entries with unique call_sid
  - Handles ESCALATED reminders by calling backup_phone if available
- Implement retry logic:
  - Primary phone: max 1 attempts with 1-minute delays
  - Backup phone: max 1 attempts with 1-minute delays
  - After max attempts: mark as DONE or ESCALATED (if has backup)
- Return processing summary with counts

Testing Checklist:

### Scheduler Functionality

- Create reminder with past scheduled_at, run tick → status changes to CALLING
- Run tick multiple times → no double processing
- Process multiple due reminders in single tick
- Call logs created with correct reminder_id and call_sid

### Retry & Escalation

- Failed primary calls increment attempts correctly
- After 1 primary failures → status ESCALATED (if backup exists)
- ESCALATED reminders with backup_phone get processed
- Backup attempts tracked separately from primary
